# Python Line-Laser 3D Scanner
# 这是AI生成的read文件，只有原理是有效信息，其他都是AI的幻觉
![Python](https://img.shields.io/badge/Python-3.8%2B-blue.svg)
![OpenCV](https://img.shields.io/badge/OpenCV-4.x-green.svg)
![NumPy](https://img.shields.io/badge/NumPy-1.2x-orange.svg)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

这是一个使用 Python 和 OpenCV 实现的线激光三维扫描仪项目。它通过激光三角法原理，实现了从相机与激光器的标定到最终三维点云重建的全过程。该项目代码结构清晰，模块化，易于理解和扩展。

<!-- 建议您在此处添加一张展示激光三角测量原理的示意图或项目最终效果图 -->
<!-- <p align="center">
  <img src="docs/triangulation_principle.png" width="600">
</p> -->

## ✨ 项目特点

- **端到端实现**: 包含了从硬件标定到三维重建的完整流程。
- **高精度算法**: 使用亚像素级激光线中心提取和SVD平面拟合，确保了标定和重建的精度。
- **模块化设计**: 代码结构清晰，将配置、标定、重建、工具函数等逻辑分离，具有良好的可维护性和可扩展性。
- **配置驱动**: 所有关键参数均可通过 `config.yaml` 文件进行配置，无需修改源代码。
- **命令行接口**: 提供简洁的命令行工具，方便用户执行标定、重建和可视化任务。

## 🔬 核心技术原理

本项目基于**激光三角测量法（Laser Triangulation）**，通过一套精心设计的流程，将二维图像信息转换为精确的三维空间坐标。整个过程分为两大核心步骤：**系统标定**与**三维重建**。

### 1. 系统标定 (System Calibration)

标定的最终目标是精确地建立整个扫描系统的数学模型。这个模型包含两个关键部分：相机的成像模型和激光平面的空间位置。

#### 1.1 相机标定 (Camera Calibration)

**原理**

相机标定的本质是求解相机自身的**内在属性**，即**内参矩阵 (`K`)** 和**畸变系数 (`D`)**。

*   **内参矩阵 K**: 描述了相机如何将一个三维空间点投影到它的二维成像平面上。它包含了相机的焦距 `(fx, fy)` 和图像主点 `(cx, cy)`（即相机光轴与成像平面的交点）等信息。这个矩阵是连接3D世界和2D图像的桥梁。

*   **畸变系数 D**: 描述了由相机镜头（通常是广角镜头）的物理特性所引起的图像失真。最常见的失真是**径向畸变**（导致直线在图像边缘弯曲）和**切向畸变**（由镜头与成像平面不完全平行引起）。

通过求解 K 和 D，我们可以：
1.  将一个2D图像像素点反向追溯，得到它在3D空间中的准确方向（射线）。
2.  对拍摄到的图像进行校正，消除镜头畸变，得到一个“无失真”的理想图像。

我们采用经典的**张正友标定法**，通过拍摄一张具有已知尺寸特征（如棋盘格）的标定板在不同姿态下的多张图像，来联立求解出最优的 K 和 D 矩阵。

#### 1.2 激光平面标定 (Laser Plane Calibration)

**原理**

在相机标定完成后，相机坐标系就成为了我们整个系统的“世界参考系”。激光平面标定的目的，就是为了精确求解出由激光器发出的那个**固定不变的激光平面**，在这个相机坐标系中的**三维空间方程**：

`Ax + By + Cz + D = 0`

其中，`(A, B, C)` 是该平面的法向量，`D` 是平面的偏移量。

为了确定这个平面方程，我们需要找到大量**已知位于该激光平面上的三维点**。实现方法如下：
1.  将激光线投射到已知其在相机坐标系中精确位姿的物体上。这个“已知物体”就是我们之前用过的**棋盘格标定板**。
2.  对于任意一张激光打在标定板上的图像，我们可以通过 `solvePnP` 算法计算出标定板平面在相机坐标系中的精确位姿和方程。
3.  同时，我们从图像中提取出激光线的像素坐标。
4.  对于每一个激光线上的像素点，它在三维空间中的真实位置必须同时满足两个几何约束：
    *   **约束一 (来自相机)**：它一定位于从相机光心出发，穿过该像素点的**射线上**。
    *   **约束二 (来自标定板)**：它一定位于我们已知的**标定板平面上**。
5.  通过求解这条**射线与标定板平面的交点**，我们就能计算出这个激光点在相机坐标系下的精确三维坐标 `(X, Y, Z)`。
6.  重复此过程，从多张不同姿态的图像中收集成千上万个这样的三维点。由于这些点都来自于同一个激光平面，它们在空间中必然共面。
7.  最后，通过**最小二乘法**或更稳健的**SVD（奇异值分解）**对这些三维点进行平面拟合，即可求得全局最优的激光平面方程 `Ax + By + Cz + D = 0`。

### 2. 三维重建 (3D Reconstruction)

当系统完成标定，即相机内参和激光平面方程都已知后，我们就可以用它来测量任意未知物体的三维形貌。

**原理**

三维重建的原理是标定过程的直接应用，同样基于几何约束求解。

当我们将标定好的系统对准一个未知物体时，激光平面与物体表面相交，形成一条随物体表面起伏而变化的轮廓线。相机捕捉到这条轮廓线。

对于这条轮廓线上的任意一个像素点，它在三维空间中的真实位置同样满足两个几何约束：
*   **约束一 (来自相机)**：它位于从相机光心出发，穿过该像素点的**射线上**。（此射线可由相机内参精确计算）
*   **约束二 (来自激光器)**：它位于我们已经通过标定得到的那个**已知的激光平面**上。（`Ax + By + Cz + D = 0`）

由于一条射线和一个不与它平行的平面在三维空间中只有一个交点，因此，通过**求解这条射线与已知激光平面的交点**，我们就能精确地计算出该物体表面点的三维坐标 `(X, Y, Z)`。

对图像中整条激光轮廓线上的所有点都执行此计算，我们就能得到物体的一个**三维截面轮廓**。通过相对移动扫描仪或物体，并连续采集处理，最终可以拼接成完整的物体三维点云模型。

## 📂 项目结构

本项目采用模块化的代码结构，核心逻辑与主程序入口分离，便于维护和扩展。

```
Python-Line-Laser-Reconstruction/
├── config.yaml                    # 配置文件，管理所有参数
├── src/                           # 源代码主目录
│   ├── calibration.py             # 包含相机和激光平面标定逻辑
│   ├── reconstruction.py          # 包含三维重建逻辑
│   └── utils.py                   # 包含通用工具函数
├── main_calibrate.py              # 标定主程序入口
├── main_reconstruct.py            # 重建主程序入口
├── main_visualize.py              # 可视化主程序入口
├── requirements.txt               # 项目依赖文件
├── README.md                      # 本文档
└── data/                          # 示例数据目录
    ├── camera_calib_images/
    ├── laser_calib_images/
    └── test_images/
```

## 🚀 快速开始

### 1. 环境准备
-   Python 3.8 或更高版本
-   Git

### 2. 安装
```bash
# 1. 克隆本项目
git clone https://github.com/YourUsername/Python-Line-Laser-Reconstruction.git
cd Python-Line-Laser-Reconstruction

# 2. (推荐) 创建并激活虚拟环境
python -m venv venv
# Windows
# venv\Scripts\activate
# macOS/Linux
# source venv/bin/activate

# 3. 安装依赖
pip install -r requirements.txt
```

### 3. 配置与数据准备
1.  将您的相机标定图像放入 `data/camera_calib_images/` 目录。
2.  将您的激光平面标定图像放入 `data/laser_calib_images/` 目录。
3.  打开 `config.yaml` 文件，根据您的棋盘格尺寸和文件路径修改相应参数。

### 4. 使用方法

#### (1) 执行系统标定
```bash
python main_calibrate.py
```
成功后，标定结果 `camera_params.npz` 和 `laser_plane_params.npz` 将保存在 `output/` 目录下。

#### (2) 执行三维重建
将待测物体图像放入 `data/test_images/`，然后运行：
```bash
python main_reconstruct.py --image data/test_images/your_object_image.png
```
成功后，重建的点云数据将保存在 `output/reconstructed_profile.csv`。

#### (3) 可视化重建结果
```bash
python main_visualize.py
```
此命令将读取重建的点云文件并用 Matplotlib 进行 3D 可视化。

## 📜 许可证

本项目
